---
- name: Ensure dependencies are installed
  ansible.builtin.apt:
    name: "{{ item }}"
    state: present
  loop:
    - iputils-ping
    - python3
    - python3-pip
    - vim

- name: Configure DNS with PiHole primary and Google fallback
  ansible.builtin.lineinfile:
    path: /etc/systemd/resolved.conf
    regexp: '^#?DNS='
    line: 'DNS=192.168.87.101 8.8.8.8 8.8.4.4'
    state: present
  notify: Restart systemd-resolved

- name: Configure DNS fallback servers
  ansible.builtin.lineinfile:
    path: /etc/systemd/resolved.conf
    regexp: '^#?FallbackDNS='
    line: 'FallbackDNS=1.1.1.1 1.0.0.1'
    state: present
  notify: Restart systemd-resolved

- name: Ensure systemd-resolved is enabled and running
  ansible.builtin.systemd:
    name: systemd-resolved
    enabled: true
    state: started
